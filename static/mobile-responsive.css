/* 
 * Mobile Responsive Enhancements
 * 針對移動端和平板設備的響應式設計優化
 */

/* ===== 移動端導航優化 ===== */
@media (max-width: 991.98px) {
    .enhanced-navbar {
        padding: 12px 0;
    }
    
    .navbar-brand .brand-text {
        font-size: 1rem;
    }
    
    .nav-tabs-enhanced {
        display: none !important;
    }
    
    /* 移動端選單 */
    .mobile-nav-menu {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--bg-secondary);
        border-top: 1px solid var(--border-color);
        z-index: 1000;
        padding: 8px 0;
    }
    
    .mobile-nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 8px 4px;
        text-decoration: none;
        color: var(--text-tertiary);
        font-size: 0.75rem;
        transition: var(--transition-fast);
    }
    
    .mobile-nav-item.active {
        color: var(--primary-blue);
    }
    
    .mobile-nav-item i {
        font-size: 1.25rem;
        margin-bottom: 4px;
    }
    
    /* 為底部導航留出空間 */
    body {
        padding-bottom: 70px;
    }
}

/* ===== 平板設備優化 ===== */
@media (max-width: 768px) {
    /* 搜尋框優化 */
    .search-enhanced {
        max-width: 100%;
    }
    
    .search-enhanced-input {
        padding: 14px 45px 14px 45px;
        font-size: 16px; /* 防止iOS縮放 */
    }
    
    /* 數據卡片優化 */
    .data-card-enhanced {
        padding: var(--space-4);
    }
    
    .data-value-enhanced {
        font-size: 1.25rem;
    }
    
    /* 按鈕優化 */
    .btn-enhanced {
        min-height: 44px; /* 提升觸控友好性 */
        padding: 12px 16px;
    }
    
    .btn-enhanced-sm {
        min-height: 36px;
        padding: 8px 12px;
        font-size: 0.875rem;
    }
    
    /* 表格優化 */
    .table-responsive {
        border-radius: var(--radius-lg);
        overflow: hidden;
    }
    
    .table-enhanced th,
    .table-enhanced td {
        padding: 12px 8px;
        font-size: 0.875rem;
    }
    
    /* 卡片間距優化 */
    .card-enhanced {
        margin-bottom: 16px;
    }
    
    .card-enhanced-body,
    .card-enhanced-header {
        padding: 16px;
    }
    
    /* 導航標籤移動端展示 */
    .nav-tabs-enhanced {
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px;
    }
    
    .nav-tab-enhanced {
        padding: 8px 12px;
        font-size: 0.875rem;
        min-width: auto;
    }
}

/* ===== 小螢幕手機優化 ===== */
@media (max-width: 576px) {
    /* 容器間距 */
    .container {
        padding-left: 16px;
        padding-right: 16px;
    }
    
    /* 數據卡片進一步優化 */
    .data-value-enhanced {
        font-size: 1.125rem;
    }
    
    .data-label-enhanced {
        font-size: 0.75rem;
    }
    
    /* 搜尋區域 */
    .search-enhanced-input {
        padding: 12px 40px 12px 40px;
    }
    
    /* 表格優化 */
    .table-enhanced {
        font-size: 0.75rem;
    }
    
    .table-enhanced th,
    .table-enhanced td {
        padding: 8px 6px;
    }
    
    /* 隱藏部分欄位在極小螢幕 */
    .table-enhanced .d-none-xs {
        display: none !important;
    }
    
    /* 按鈕群組優化 */
    .btn-group-mobile {
        display: flex;
        flex-direction: column;
        gap: 8px;
        width: 100%;
    }
    
    .btn-group-mobile .btn-enhanced {
        width: 100%;
        justify-content: center;
    }
    
    /* 模態框優化 */
    .modal-dialog {
        margin: 16px;
    }
    
    /* 卡片標題優化 */
    .card-enhanced-header h5 {
        font-size: 1rem;
    }
    
    /* 工具提示在移動端禁用 */
    .tooltip-enhanced::before,
    .tooltip-enhanced::after {
        display: none !important;
    }
}

/* ===== 超小螢幕優化 ===== */
@media (max-width: 400px) {
    .data-value-enhanced {
        font-size: 1rem;
    }
    
    .search-enhanced-input {
        padding: 10px 35px 10px 35px;
        font-size: 16px;
    }
    
    .btn-enhanced {
        padding: 10px 12px;
        font-size: 0.875rem;
    }
    
    /* 極簡化表格 */
    .table-compact th,
    .table-compact td {
        padding: 6px 4px;
        font-size: 0.75rem;
    }
}

/* ===== 橫向模式優化 ===== */
@media (max-height: 500px) and (orientation: landscape) {
    .mobile-nav-menu {
        display: none;
    }
    
    body {
        padding-bottom: 0;
    }
    
    .enhanced-navbar {
        padding: 8px 0;
    }
    
    /* 減少垂直間距 */
    .data-card-enhanced {
        padding: 12px;
    }
    
    .card-enhanced-body,
    .card-enhanced-header {
        padding: 12px;
    }
}

/* ===== 觸控優化 ===== */
@media (pointer: coarse) {
    /* 增大可點擊區域 */
    .btn-enhanced,
    .nav-tab-enhanced,
    .mobile-nav-item {
        min-height: 44px;
    }
    
    /* 表格行優化 */
    .table-enhanced tr {
        min-height: 48px;
    }
    
    /* 搜尋清除按鈕 */
    .search-enhanced-clear {
        min-width: 44px;
        min-height: 44px;
    }
}

/* ===== 摺疊式內容 ===== */
.collapsible-mobile {
    display: block;
}

@media (max-width: 768px) {
    .collapsible-mobile {
        display: none;
    }
    
    .collapsible-mobile.show {
        display: block;
    }
    
    .collapse-trigger {
        cursor: pointer;
        user-select: none;
    }
    
    .collapse-trigger::after {
        content: '\f107';
        font-family: 'bootstrap-icons';
        float: right;
        transition: transform 0.3s ease;
    }
    
    .collapse-trigger.collapsed::after {
        transform: rotate(-90deg);
    }
}

/* ===== 移動端專用組件 ===== */
.mobile-only {
    display: none;
}

@media (max-width: 768px) {
    .mobile-only {
        display: block;
    }
    
    .desktop-only {
        display: none !important;
    }
}

/* ===== 滑動手勢支援 ===== */
.swipeable {
    touch-action: pan-x;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.swipeable::-webkit-scrollbar {
    display: none;
}

/* ===== 移動端表格改進 ===== */
@media (max-width: 768px) {
    .table-mobile-stack {
        display: block;
    }
    
    .table-mobile-stack thead {
        display: none;
    }
    
    .table-mobile-stack tbody,
    .table-mobile-stack tr,
    .table-mobile-stack td {
        display: block;
        width: 100%;
    }
    
    .table-mobile-stack tr {
        background: var(--bg-panel);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-lg);
        margin-bottom: 12px;
        padding: 16px;
    }
    
    .table-mobile-stack td {
        border: none;
        padding: 8px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .table-mobile-stack td::before {
        content: attr(data-label);
        font-weight: 600;
        color: var(--text-secondary);
        font-size: 0.875rem;
    }
}

/* ===== 移動端載入狀態 ===== */
.mobile-loading {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary-blue), var(--primary-blue-light));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
    z-index: 9999;
}

.mobile-loading.show {
    transform: scaleX(1);
}

/* ===== 移動端搜尋增強 ===== */
@media (max-width: 768px) {
    .search-enhanced-mobile {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        padding: 12px 16px;
        z-index: 1000;
        transform: translateY(-100%);
        transition: transform 0.3s ease;
    }
    
    .search-enhanced-mobile.show {
        transform: translateY(0);
    }
    
    .search-enhanced-mobile .search-enhanced-input {
        background: var(--bg-primary);
        border: 2px solid var(--border-color);
    }
}

/* ===== 性能優化 ===== */
@media (max-width: 768px) {
    /* 減少動畫以提升性能 */
    .reduce-motion * {
        animation-duration: 0.1s !important;
        transition-duration: 0.1s !important;
    }
    
    /* 簡化陰影 */
    .shadow-simplified {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
    }
}

/* ===== 可訪問性增強 ===== */
@media (max-width: 768px) {
    /* 增加對比度 */
    .high-contrast-mobile {
        --text-primary: #FFFFFF;
        --text-secondary: #E5E5E5;
        --border-color: #666666;
    }
    
    /* 大字體模式 */
    .large-text * {
        font-size: 1.125em !important;
        line-height: 1.6 !important;
    }
    
    /* 減少動畫 */
    @media (prefers-reduced-motion: reduce) {
        .animate-slide-in-up,
        .animate-fade-in {
            animation: none !important;
        }
        
        * {
            transition: none !important;
        }
    }
}

/* ===== 移動端特殊狀態 ===== */
@media (max-width: 768px) {
    /* 焦點狀態增強 */
    .focus-enhanced:focus {
        outline: 3px solid var(--primary-blue);
        outline-offset: 2px;
    }
    
    /* 活動狀態 */
    .btn-enhanced:active,
    .nav-tab-enhanced:active {
        transform: scale(0.95);
        background: var(--bg-active);
    }
    
    /* 長按效果 */
    .long-press {
        user-select: none;
        -webkit-touch-callout: none;
    }
}

/* ===== PWA 支援 ===== */
@media (display-mode: standalone) {
    .enhanced-navbar {
        padding-top: env(safe-area-inset-top, 12px);
    }
    
    .mobile-nav-menu {
        padding-bottom: env(safe-area-inset-bottom, 8px);
    }
    
    /* 狀態列適配 */
    .status-bar-spacer {
        height: env(safe-area-inset-top, 0);
        background: var(--bg-secondary);
    }
}

/* ===== 調試工具（開發環境） ===== */
.debug-mobile {
    position: fixed;
    bottom: 80px;
    right: 16px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 9999;
    font-family: monospace;
}

/* 僅在開發環境顯示 */
body:not(.production) .debug-mobile::after {
    content: attr(data-viewport);
}